# 開発ワークフロー

エージェント間の責任範囲と開発フローを定義します。

## Workflow Overview

```
┌─────────────────────────────────────────────────────────────┐
│                    Development Workflow                      │
└─────────────────────────────────────────────────────────────┘

Phase 1: Investigation
┌──────────────────────────────────────────┐
│  @code-investigator                      │
│  ────────────────────────────────────    │
│  ✅ 既存コード構造の理解                │
│  ✅ 関連ファイルの特定 (Kiri MCP)      │
│  ✅ 影響範囲の分析                      │
│  ✅ 既存パターンの抽出                  │
│                                          │
│  ❌ 計画策定 (担当外)                   │
│  ❌ コード実装 (担当外)                 │
│  ❌ 品質検証 (担当外)                   │
└──────────────────────────────────────────┘
                  │
                  ▼ 調査完了
                  │
Phase 2: Planning (Plan Mode)
┌──────────────────────────────────────────┐
│  @code-planner                           │
│  ────────────────────────────────────    │
│  ✅ 実装アプローチの設計                │
│  ✅ タスクの分解と優先順位付け          │
│  ✅ トレードオフの整理                  │
│  ✅ ユーザー承認の取得                  │
│                                          │
│  🔧 使用ツール: EnterPlanMode,          │
│     ExitPlanMode, Read, Glob, Grep      │
│                                          │
│  ❌ コード実装 (担当外)                 │
│  ❌ 品質検証 (担当外)                   │
└──────────────────────────────────────────┘
                  │
                  ▼ 計画承認
                  │
Phase 3: Implementation
┌──────────────────────────────────────────┐
│  @code-implementer                       │
│  ────────────────────────────────────    │
│  ✅ 計画に基づくコード実装              │
│  ✅ ベストプラクティス準拠              │
│  ✅ エッジケース処理                    │
│                                          │
│  🔧 使用ツール: Serena MCP, Edit, Write │
│                                          │
│  ❌ 事前調査 (委任済)                   │
│  ❌ 計画策定 (委任済)                   │
│  ❌ 型チェック/Lint (委任)              │
└──────────────────────────────────────────┘
                  │
                  ▼ 実装完了
                  │
Phase 4-6: Verification & Quality Check
┌──────────────────────────────────────────┐
│  @code-safety-inspector                  │
│  ────────────────────────────────────    │
│  ✅ TypeScript型チェック                │
│  ✅ ESLint/Prettier検証                 │
│  ✅ プロジェクト規約確認                │
│  ✅ 品質レポート作成                    │
│  ✅ コミット可否判定                    │
│                                          │
│  ❌ コード実装 (担当外)                 │
│  ❌ リファクタリング (担当外)           │
└──────────────────────────────────────────┘
                  │
                  ▼
        ✅ 合格 → コミット
        ❌ 問題 → @code-implementer へフィードバック
```

## Responsibility Matrix

| タスク | @code-investigator | @code-planner | @code-implementer | @code-safety-inspector |
|--------|-------------------|---------------|-------------------|------------------------|
| 既存コード構造の理解 | ✅ | ❌ | ❌ | ❌ |
| 関連ファイルの特定 | ✅ | ❌ | ❌ | ❌ |
| 影響範囲の分析 | ✅ | ❌ | ❌ | ❌ |
| 既存パターンの抽出 | ✅ | ❌ | ❌ | ❌ |
| 実装アプローチの設計 | ❌ | ✅ | ❌ | ❌ |
| タスク分解・優先順位 | ❌ | ✅ | ❌ | ❌ |
| ユーザー承認の取得 | ❌ | ✅ | ❌ | ❌ |
| コード実装 | ❌ | ❌ | ✅ | ❌ |
| リファクタリング | ❌ | ❌ | ✅ | ❌ |
| TypeScript型チェック | ❌ | ❌ | ❌ | ✅ |
| ESLint実行 | ❌ | ❌ | ❌ | ✅ |
| Prettier実行 | ❌ | ❌ | ❌ | ✅ |
| プロジェクト規約検証 | ❌ | ❌ | ❌ | ✅ |
| 品質レポート作成 | ❌ | ❌ | ❌ | ✅ |

## Usage Examples

### 基本的な使い方（4ステップ）

```bash
# 1. 調査
@code-investigator
「ユーザー認証機能を追加してください」

# 2. 計画（調査完了後）
@code-planner
# → Plan モードで実装計画を策定
# → ユーザーの承認を取得

# 3. 実装（計画承認後）
@code-implementer

# 4. 検証（実装完了後）
@code-safety-inspector
```

### 推奨パターン

```bash
# パターン1: 完全な4フェーズ実行（複雑な変更）
@code-investigator でコードベース調査
   ↓
@code-planner で実装計画策定・承認
   ↓
@code-implementer で実装
   ↓
@code-safety-inspector で検証

# パターン2: 計画フェーズ込み（中程度の変更）
@code-planner で計画策定（調査も含む）
   ↓
@code-implementer で実装
   ↓
@code-safety-inspector で検証

# パターン3: 簡単な変更の場合（調査・計画スキップ）
@code-implementer で実装（既に理解している変更）
   ↓
@code-safety-inspector で検証
```

### フェーズ選択ガイド

| 変更の複雑さ | 調査 | 計画 | 実装 | 検証 |
|-------------|-----|-----|-----|-----|
| 複雑（多ファイル、アーキテクチャ変更） | ✅ | ✅ | ✅ | ✅ |
| 中程度（複数ファイル、明確なパターン） | △ | ✅ | ✅ | ✅ |
| 単純（1-2ファイル、軽微な変更） | ❌ | ❌ | ✅ | ✅ |

### 問題が見つかった場合

```
@code-safety-inspector: 型エラー検出
   ↓
レポート作成（エラー箇所と修正案を提示）
   ↓
@code-implementer: 修正実装
   ↓
@code-safety-inspector: 再検証
```

## Related Resources

- **TypeScript実装ベストプラクティス**:
  - `/ts-implement`
- **エージェント詳細定義**:
  - `~/.claude/agents/code-investigator.md`
  - `~/.claude/agents/code-planner.md`
  - `~/.claude/agents/code-implementer.md`
  - `~/.claude/agents/code-safety-inspector.md`
- **グローバル開発ガイドライン**:
  - `~/.claude/CLAUDE.md`

